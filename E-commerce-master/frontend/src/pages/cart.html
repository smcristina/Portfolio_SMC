<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrello - Artigianato Online</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/components/navbar.css">
    <link rel="stylesheet" href="../styles/components/cart-page.css">
</head>
<body>
    <!-- Navbar (stesso della home) -->
    <nav class="navbar">
        <div class="container">
            <!-- Brand del sito -->
            <div class="nav-brand">
                <a href="index.html">Artigianato Online</a>
            </div>
    
            <!-- Icona di toggle per il menu mobile -->
            <div class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
    
            <!-- Lista dei link del menu -->
            <ul class="nav-menu">
                <li><a href="products.html">Prodotti</a></li>
                <li><a href="categories.html">Categorie</a></li>
                <li>
                    <a href="cart.html" class="cart-button">
                        Carrello <span class="cart-count">(0)</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>     

    <main class="cart-page">
        <div class="container">
            <h1>Il tuo carrello</h1>
            <div class="cart-layout">
                <!-- Sezione lista prodotti -->
                <div class="cart-items">
                    <div id="cartItemsList">
                        <!-- Items verranno inseriti via JavaScript -->
                    </div>
                    <div class="cart-empty" id="emptyCart" style="display: none;">
                        <img src="../assets/images/empty-cart.svg" alt="Carrello vuoto">
                        <h2>Il tuo carrello è vuoto</h2>
                        <p>Aggiungi alcuni prodotti per iniziare lo shopping!</p>
                        <a href="index.html" class="btn btn-primary">Continua lo Shopping</a>
                    </div>
                </div>

                <!-- Sezione riepilogo -->
                <div class="cart-summary" id="cartSummary">
                    <h2>Riepilogo ordine</h2>
                    <div class="summary-details">
                        <div class="summary-row">
                            <span>Subtotale</span>
                            <span id="subtotal">€0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Spedizione</span>
                            <span id="shipping">€0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>IVA (22%)</span>
                            <span id="tax">€0.00</span>
                        </div>
                        <div class="summary-row total">
                            <span>Totale</span>
                            <span id="totalAmount">€0.00</span>
                        </div>
                    </div>

                    <button id="checkoutBtn" class="btn btn-primary btn-checkout">
                        Procedi al Checkout
                    </button>

                    <a href="index.html" class="btn btn-secondary btn-continue">
                        Continua lo Shopping
                    </a>
                </div>
            </div>
        </div>
    </main>

   <!-- Sostituisci la sezione degli script alla fine del file -->
   <script src="../js/components/products.js"></script>
   <script src="../js/components/cart.js"></script>
   <script src="../js/components/navbar.js"></script>
   <script src="../js/main.js"></script>

<script>
// Aggiungi questo script inline o crealo come file separato cart-page.js
document.addEventListener('DOMContentLoaded', () => {
    const cartItemsList = document.getElementById('cartItemsList');
    const emptyCart = document.getElementById('emptyCart');
    const cartSummary = document.getElementById('cartSummary');

    function renderCart() {
        const items = cart.items;

        if (items.length === 0) {
            cartItemsList.innerHTML = '';
            emptyCart.style.display = 'block';
            cartSummary.style.display = 'none';
            return;
        }

        emptyCart.style.display = 'none';
        cartSummary.style.display = 'block';

        cartItemsList.innerHTML = items.map(item => `
            <div class="cart-item">
                <img src="${item.image}" alt="${item.name}">
                <div class="item-details">
                    <h3>${item.name}</h3>
                    <p>Prezzo: €${item.price.toFixed(2)}</p>
                    <div class="quantity-controls">
                        <button onclick="updateQuantity(${item.productId}, ${item.quantity - 1})">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="updateQuantity(${item.productId}, ${item.quantity + 1})">+</button>
                    </div>
                </div>
                <button onclick="removeFromCart(${item.productId})">Rimuovi</button>
            </div>
        `).join('');

        // Calcola e aggiorna i totali
        const subtotal = cart.getTotal();
        const shipping = subtotal > 0 ? 7.99 : 0;
        const tax = subtotal * 0.22; // IVA 22%
        const total = subtotal + shipping + tax;

        document.getElementById('subtotal').textContent = `€${subtotal.toFixed(2)}`;
        document.getElementById('shipping').textContent = `€${shipping.toFixed(2)}`;
        document.getElementById('tax').textContent = `€${tax.toFixed(2)}`;
        document.getElementById('totalAmount').textContent = `€${total.toFixed(2)}`;
    }

    // Funzioni di supporto per il carrello
    window.updateQuantity = function(productId, newQuantity) {
        if (newQuantity < 1) return;
        const item = cart.items.find(item => item.productId === productId);
        if (item) {
            item.quantity = newQuantity;
            cart.saveCart();
            renderCart();
        }
    };

    window.removeFromCart = function(productId) {
        cart.removeItem(productId);
        renderCart();
    };

    // Renderizza il carrello all'avvio
    renderCart();
});
</script>
</body>
</html>
