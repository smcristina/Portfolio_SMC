<main>
  <div class="header">
    <h2 class="h2">Richieste</h2>
    <div class="input-button-container">
      <input type="text" placeholder="Search by any value" [(ngModel)]="searchTerm" (input)="applyFilter()" />
    </div>
  </div>

  <div class="table-container">

    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

      <ng-container matColumnDef="request_code">
        <th mat-header-cell *matHeaderCellDef> Codice Richiesta </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)">
          <span class="role-chip">
            {{
            request.request_code
            }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="lead_data">
        <th mat-header-cell *matHeaderCellDef> Data </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)"> {{ request.request_date |
          date:'dd/MM/yyyy'}}
        </td>
      </ng-container>

      <ng-container matColumnDef="company_name">
        <th mat-header-cell *matHeaderCellDef> Ragione Sociale </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)"> {{ request.company_name
          }} </td>
      </ng-container>

      <ng-container matColumnDef="partita_iva">
        <th mat-header-cell *matHeaderCellDef> Partita IVA </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)"> {{ request.partita_iva
          }} </td>
      </ng-container>

      <ng-container matColumnDef="sales_owner">
        <th mat-header-cell *matHeaderCellDef> Referente </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)">
          <span *ngIf="request.client_contact_name == '' || request.client_contact_name == null"
            style="font-style: italic; color: #838081e1;">
            Non disponibile
          </span>
          {{ request.client_contact_name }}
        </td>

      </ng-container><ng-container matColumnDef="contact_email">
        <th mat-header-cell *matHeaderCellDef> Email Referente </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)">
          <span *ngIf="request.client_contact_email == '' || request.client_contact_email == null"
            style="font-style: italic; color: #838081e1;">
            Non disponibile
          </span>
          {{ request.client_contact_email }}
        </td>
      </ng-container>

      <ng-container matColumnDef="budget">
        <th mat-header-cell *matHeaderCellDef> Budget </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)"> {{ request.budget |
          currency: 'EUR' }}
        <td>
      </ng-container>


      <ng-container matColumnDef="has_pnl">
        <th mat-header-cell *matHeaderCellDef> PNL </th>
        <td mat-cell *matCellDef="let request">
          <i *ngIf="request.has_pnl == 1" (click)="openDetailedView(request.id)" class="material-icons"
            style="color: rgb(2, 88, 2)">bookmark_added</i>
          <i *ngIf="request.has_pnl == 0 || request.has_pnl == null" (click)="addPNL(request.id)" class="material-icons"
            style="color: rgb(156, 1, 40)">bookmark_add</i>
        </td>
      </ng-container>

      <ng-container matColumnDef="owner">
        <th mat-header-cell *matHeaderCellDef> Owner </th>
        <td mat-cell *matCellDef="let request" (click)="openDetailedView(request.id)">
          {{request.owner}}
        </td>
      </ng-container>

      <ng-container matColumnDef="archive">
        <th mat-header-cell *matHeaderCellDef> Archivia </th>
        <td mat-cell *matCellDef="let request">
          <i class="material-icons">archive</i>
        </td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

</main>